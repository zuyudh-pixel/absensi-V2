<!DOCTYPE html>
<html>
<head>
  <title>Absensi Online</title>
</head>
<body>

<h2>Login Pegawai</h2>

<input type="text" id="id" placeholder="ID Pegawai"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>

<hr>

<div id="absenArea" style="display:none;">
  <h3 id="userInfo"></h3>

  <select id="workfrom">
    <option value="WFO">WFO</option>
    <option value="WFH">WFH</option>
  </select><br><br>

  <input type="text" id="kegiatan" placeholder="Kegiatan"><br><br>

  <button onclick="absen('Masuk')">Absen Masuk</button>
  <button onclick="absen('Pulang')">Absen Pulang</button>
</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxYhb5goSdgzgxtBOtaidXZli2tMVvKXFaGyR3o19JAIaOlJ4lZbaRyWfr50pcQ1YoVTQ/exec";
let currentUser = {};

function login() {
  const id = document.getElementById("id").value;
  const password = document.getElementById("password").value;

  fetch(WEB_APP_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "login",
      id: id,
      password: password
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {

      currentUser = {
        id: id,
        password: password,
        nama: data.nama
      };

      document.getElementById("absenArea").style.display = "block";
      document.getElementById("userInfo").innerText =
        data.nama + " - " + data.bagian;

    } else {
      alert("Login gagal!");
    }
  });
}

function absen(tipe) {

  navigator.geolocation.getCurrentPosition(function(position) {

    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    const workfrom = document.getElementById("workfrom").value;
    const kegiatan = document.getElementById("kegiatan").value;

    fetch(WEB_APP_URL, {
      method: "POST",
      body: new URLSearchParams({
        action: "absen",
        id: currentUser.id,
        password: currentUser.password,
        nama: currentUser.nama,
        tipe: tipe,
        workfrom: workfrom,
        kegiatan: kegiatan,
        latitude: latitude,
        longitude: longitude
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.status === "success") {
        alert("Absensi berhasil!");
      }
    });

  });

}

</script>

</body>
</html>
